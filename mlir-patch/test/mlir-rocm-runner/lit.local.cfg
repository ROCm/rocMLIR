import subprocess

# If rocm_agent_enumerator shows no viable GPUs, skip these tests because
# the default target will lead to compilation failures.
if config.rocm_path:
   try:
      p = subprocess.run([config.rocm_path + "/bin/rocm_agent_enumerator"],
                         check=True, capture_output=True)
   except subprocess.CalledProcessError:
      config.unsupported = True

   agents = [x for x in p.stdout.split() if x != b'gfx000']
   if not agents:
      config.unsupported = True

if not config.enable_rocm_runner:
  config.unsupported = True
