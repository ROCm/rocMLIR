directory = "PrGemm"
prefix = "rocmlir-gen"
suffix = "--operation gemm --arch %arch %pv %random_data %rocmlir_gen_flags | rocmlir-driver -c | mlir-cpu-runner -O2 --shared-libs=%linalg_test_lib_dir/libmlir_rocm_runtime%shlibext,%conv_validation_wrapper_library_dir/libconv-validation-wrappers%shlibext,%linalg_test_lib_dir/libmlir_runner_utils%shlibext,%linalg_test_lib_dir/libmlir_float16_utils%shlibext --entry-point-result=void | FileCheck %s --check-prefix="

[[axis]]
name = "transA"
values = ["true", "false"]
prefix = "--transA="

# We'll only test one transpose setting in PR tests
#[[axis]]
#name = "transB"
#values = ["true", "false"]
#prefix = "--transB="

#[[axis]]
#name = "transC"
#values = ["true", "false"]
#prefix = "--transC="

# Note: only one fp8 variant is tested as that's enough for a sanity check
[[axis]]
name = "data type"
values = ["f32", "f16", "i8", "fp8_bf8"]
prefix = "-t "

## Gemm variants
[[suite]]
name = "pr_gemm"

[[suite.test]]
config = "-g 3 -m 1024 -k 769 -n 1024"
# Don't re-test f16 and i8 with transposes: it won't give us much new
[[suite.test.exclude]]
name = "data type"
values = ["f16", "i8", "fp8_bf8"]
[[suite.test.exclude]]
name = "transA"
values = ["true"]

# Test large tensors with padding
[[suite.test]]
config = "-g 1 -m 32768 -k 1 -n 32769"
# Only test f32 here
[[suite.test.exclude]]
name = "data type"
values = ["f16", "i8", "fp8_bf8"]
