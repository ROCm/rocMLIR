# NOTE: Assertions have been autogenerated by utils/update_mir_test_checks.py
# RUN: llc -mtriple=amdgcn-amd-amdhsa -mcpu=gfx90a -run-pass=si-simplify-predicated-copies -verify-machineinstrs %s -o - | FileCheck -check-prefix=GCN %s

# The test goes into infinite loop while checking for isWWMCopy().
# getUniqueVRegDef of the SrcReg returns the instruction itself if it is a partial copy.
# wwm-copies will always be a full copy and hence skip subreg copies while checking for one.

---
name:            subreg_copy
tracksRegLiveness: true
machineFunctionInfo:
  isEntryFunction: false
body:             |
  bb.0:
    ; GCN-LABEL: name: subreg_copy
    ; GCN: dead undef %0.sub3:vreg_128_align2 = COPY undef %0.sub1, implicit $exec
    ; GCN-NEXT: SI_RETURN
    dead undef %0.sub3:vreg_128_align2 = COPY undef %0.sub1
    SI_RETURN
...
